<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Penilaian Tahfidz</title>
  <style>
    body { background: #f4f7fa; font-family: Arial, sans-serif; }
    .container { background: #fff; max-width: 400px; margin: 30px auto; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.08); padding: 32px 24px; }
    h2 { text-align: center; margin-bottom: 24px; font-size: 1.5em; font-weight: bold; }
    label { display: block; margin-bottom: 6px; font-size: 1em; }
    select, textarea { width: 100%; padding: 8px 10px; margin-bottom: 16px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em; box-sizing: border-box; }
    textarea { resize: vertical; min-height: 60px; max-height: 120px; }
    .btn-submit { width: 100%; padding: 10px 0; background: #22c55e; color: #fff; border: none; border-radius: 6px; font-size: 1em; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .btn-submit:hover { background: #16a34a; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Penilaian Tahfidz</h2>
    <form>
      <label for="penguji">Nama Penguji</label>
      <select id="penguji" name="penguji"><option value="">Memuat...</option></select>

      <label for="kelas">Kelas</label>
      <select id="kelas" name="kelas"><option value="">Memuat...</option></select>

      <label for="siswa">Nama Siswa</label>
      <select id="siswa" name="siswa"><option value="">Pilih kelas dulu</option></select>

      <label for="surat">Surat</label>
      <select id="surat" name="surat"><option value="">Memuat...</option></select>

      <label for="keterangan">Keterangan</label>
      <select id="keterangan" name="keterangan"><option value="">Memuat...</option></select>

      <label for="catatan">Catatan:</label>
      <textarea id="catatan" name="catatan" placeholder="Tulis catatan di sini..."></textarea>

      <button type="submit" class="btn-submit">Kirim</button>
    </form>
  </div>

  <script>
    // Link spreadsheet BARU
    const baseUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR2sH-s2vgdr92fkUTW3szhKHQQPZhuuUXd62S-kk95uVXJ57kVw8LCnkDBMvzaneEP3t5A4-ePE70q/gviz/tq?tqx=out:json&sheet=';

    // Nama sheet sesuai spreadsheet BARU
    const sheetNames = {
      penguji: 'Nama',
      kelas: 'Kelas',
      siswaX: 'Nama Siswa',    // Sheet ini gabungan siswa kelas X, XI, XII di sheet yang sama, jadi kita filter nanti
      surat: 'Surat',
      keterangan: 'Keterangan'
    };

    // Fungsi fetch data dari sheet, mengembalikan array string
    async function fetchSheet(sheetName) {
      const url = baseUrl + encodeURIComponent(sheetName);
      const res = await fetch(url);
      const text = await res.text();
      // Parsing JSONP Google Sheets
      const json = JSON.parse(text.substring(47, text.length - 2));
      const rows = json.table.rows;
      // Ambil kolom B (index 1) jika ada, kalau tidak ambil kolom A (index 0)
      return rows.map(r => (r.c[0]?.v) ).filter(Boolean);
    }

    // Isi dropdown Nama Penguji
    fetchSheet(sheetNames.penguji).then(data => {
      const select = document.getElementById('penguji');
      select.innerHTML = '<option value="">Pilih Penguji</option>' + data.map(v => `<option>${v}</option>`).join('');
    });

    // Isi dropdown Kelas
    fetchSheet(sheetNames.kelas).then(data => {
      const select = document.getElementById('kelas');
      select.innerHTML = '<option value="">Pilih Kelas</option>' + data.map(v => `<option>${v}</option>`).join('');
    });

    // Isi dropdown Surat
    fetchSheet(sheetNames.surat).then(data => {
      const select = document.getElementById('surat');
      select.innerHTML = '<option value="">Pilih Surat</option>' + data.map(v => `<option>${v}</option>`).join('');
    });

    // Isi dropdown Keterangan
    fetchSheet(sheetNames.keterangan).then(data => {
      const select = document.getElementById('keterangan');
      select.innerHTML = '<option value="">Pilih Keterangan</option>' + data.map(v => `<option>${v}</option>`).join('');
    });

    // Data siswa sudah diambil sekali saja, nanti filter berdasarkan kelas
    let allSiswa = [];

    // Ambil data siswa sekali
    fetchSheet(sheetNames.siswaX).then(data => {
      allSiswa = data;
      // Awalnya kosong, tunggu kelas dipilih
      document.getElementById('siswa').innerHTML = '<option value="">Pilih kelas dulu</option>';
    });

    // Event change kelas, filter siswa sesuai kelas
    document.getElementById('kelas').addEventListener('change', function() {
      const kelas = this.value.trim();
      const selectSiswa = document.getElementById('siswa');

      if (!kelas) {
        selectSiswa.innerHTML = '<option value="">Pilih kelas dulu</option>';
        return;
      }

      // Filter siswa berdasarkan awalan nama kelas (misal X, XI, XII)
      // Karena data siswa gabungan, kita asumsikan nama siswa tidak mengandung kelas, jadi kita perlu data kelas yang lebih detail.
      // Namun dari data yang Anda berikan, tidak ada kelas per siswa, jadi kita tampilkan semua siswa (atau Anda bisa sesuaikan manual).

      // Jika Anda punya cara membedakan siswa per kelas, bisa implementasi filter di sini.
      // Untuk sementara tampilkan semua siswa.

      selectSiswa.innerHTML = '<option value="">Pilih Siswa</option>' + allSiswa.map(v => `<option>${v}</option>`).join('');
    });
  </script>
</body>
</html>
